<template>
  <div>

  	<div class="user-data-statistics" >
  		
  		<el-row :gutter="20">
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">服务企业总数 <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{serviceCompanyTotal.total}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>	
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>	  
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">消防管家用户数 <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.fireUserCount}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>		  
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">接入面积(万平米) <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.allBuildArea}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>	  
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">托管面积(万平米) <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.allBuildAreaForTG}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>
			</el-row>
			<el-row :gutter="20">
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">服务家庭/商户总数 <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.userNums}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>
			  
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">注册数 <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.homeNums}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>
			  
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">服务机构总数 <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.orgCount}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>
			  
			  <el-col :span="6">
			  	<div class="grid-content">
			  		<p class="users-title">维保用户数 <!--<span class="iconfont icon-info"></span>--></p>
			  		<p class="users-number">{{unitData.userCount}}</p>
			  		<!--<div class="users-rate">
			  			<el-row :gutter="20">
			  				<el-col :span="6">周同比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u203.png" width="8"/></i> 12%</el-col>
			  				<el-col :span="6">日环比</el-col>
			  				<el-col :span="6"><i><img src="../assets/img/u210.png" width="8"/></i> 12%</el-col>
			  			</el-row>
			  		</div>
						<p class="add-rate">
							日均增长量：<span>423</span>
						</p>-->
			  	</div>
			  </el-col>
			</el-row>
			
			
  	</div>
  	
  	
  	<div class="company-service-type">
  		<el-row :gutter="20">
			  <el-col :span="15">
			  		<div class="new-add-company">
			  			<h4>新增企业趋势</h4>
			  			<div class="" id="new-add-company" :style="{width: '100%', height: '300px'}"></div>
			  			<!--<el-row :gutter="20">
			  				<el-col :span="4" class="company-data">
			  					<ul>
			  						<li>
			  							<p>8,846</p>
			  							<span>昨日新增</span>
			  						</li>
			  						<li>
			  							<p>17.1%</p>
			  							<span>较前一日</span>
			  						</li>
			  					</ul>
			  				</el-col>
			  				<el-col :span="20" class="company-echarts">
			  					<div class="" id="new-add-company" :style="{width: '100%', height: '300px'}"></div>
			  				</el-col>
			  			</el-row>-->
			  			
			  		</div>
			  </el-col>
			  <el-col :span="9">
			  	<div  class="service-type-place">
			  		<h4>服务模式分布</h4>
			  		
			  		<el-row>
			  			<el-col :span="12">
			  				<div class="" id="service-type" :style="{width: '100%', height: '300px'}"></div>
			  				<div class="m-title">
			  					<span>服务总数</span>
			  					<p>{{serviceCompanyTotal.total}}</p>
			  				</div>
			  			</el-col>
			  			<el-col :span="12">
			  				<ul class="m-list">
									<li class="i-chart"  v-for="(mode, index) in serviceTypeData">
										<i class="dot" :class="colorList[index]"></i>
										<label class="label">{{ mode.name }}</label>
										<span class="rates"> <b>|</b>{{ mode.rate }}</span>
										<span class="count">{{ mode.value }}</span>
									</li>
								</ul>
			  			</el-col>
			  		</el-row>
			  	</div>
			  </el-col>
			</el-row>  
  	</div>
  	
  	<div class="company-service-type" style="margin-bottom: 0;">
  		<div  class="service-type-place">
		  		<h4>硬件设备供应分类</h4>
		  		<div class="" id="hardware-type" :style="{width: '100%', height: '300px'}"></div>
		  	</div>
  	</div>
  	
  	<!--<div class="alarm-device-rate" style="">
  		<el-row :gutter="20">
			  <el-col :span="17">
			  	<div class="alarm-rate">
			  		<h4>报警类目占比</h4>
			  		<el-row :gutter="20">
			  			<el-col :span="6">
			  				<div class="" id="fire-alarm" :style="{width: '100%', height: '160px'}"></div>
			  				<p>火警</p>
			  			</el-col>
			  			<el-col :span="6">
			  				<div class="" id="personal-report" :style="{width: '100%', height: '160px'}"></div>
			  				<p>人工上报</p>
			  			</el-col>
			  			<el-col :span="6">
			  				<div class="" id="device-offline" :style="{width: '100%', height: '160px'}"></div>
			  				<p>设备离线</p>
			  			</el-col>
			  			<el-col :span="6">
			  				<div class="" id="device-trouble" :style="{width: '100%', height: '160px'}"></div>
			  				<p>设备隐患</p>
			  			</el-col>
			  		</el-row>
			  	</div>
			  		
			  </el-col>
			  <el-col :span="7">
			  	<div  class="device-rate">
			  		<h4>设备在线率</h4>
						<div class="" id="device-online" :style="{width: '100%', height: '260px'}"></div>
			  	</div>
			  </el-col>
			</el-row>  
  	</div>-->
  </div>
</template>

<script>
var HOME_CHART = {}; //图表对象

import { mapState, mapMutations, mapActions, mapGetters } from 'vuex';
import echarts from 'echarts'
export default {
	name: "index",
	data(){
		return {
			input:'',
			activeName: 'first',
			unitData:{},
			serviceCompanyTotal:{},
			isLoading:false,
			newAddCompanyData:{},
			serviceTypeData:[],
			colorList:['freeNum','safetyNum','transferNum','hightNum','fullyNum','primaryNum'],
			hardwareSupplyData:{},
		}
	},
	computed:{
		count(){
        return this.$store.state.count
    },
	},
	methods: {
	  setChart(){
	  	var _self = this;
	  	
	  	//新增企业趋势
	  	HOME_CHART.newCompany = echarts.init(document.getElementById('new-add-company'));
	  	HOME_CHART.newCompany.setOption({
	  		tooltip: {
		        trigger: 'axis'
		    },
		    color:['#1C77FF'],
		    grid: {
					left: '2%',
					right: '2%',
					bottom: '7%',
					containLabel: true
				},
		    xAxis: {
		        type: 'category',
		        data: _self.newAddCompanyData.xData,
		        axisLine:{
				    	lineStyle:{
				    		color:'#e6e9ee'
				    	}
				    },
				    splitLine:{
				    	lineStyle:{
				    		color:'#e6e9ee'
				    	}
				    },
				    axisLabel:{
				    	color:'#a5adb8'
				    },
				    axisTick:{       //y轴刻度线
		          show:false
		        },
		    },
		    yAxis: {
		        type: 'value',
		        axisLine:{
		        	show:false,
				    	lineStyle:{
				    		color:'#e6e9ee'
				    	}
				    },
				    splitLine:{
				    	lineStyle:{
				    		color:'#e6e9ee'
				    	}
				    },
				    axisLabel:{
				    	color:'#a5adb8'
				    },
				    axisTick:{       //y轴刻度线
		          show:false
		        },
		    },
		    series: [{
		    		name: "新增企业个数",
		        data: _self.newAddCompanyData.yData,
		        type: 'line',
		        smooth: true,
		        areaStyle: {
            normal: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                    offset: 0,
                    color: '#e8f1ff'
                }, {
                    offset: 1,
                    color: '#ffffff'
                }])
            }
        	},
		    }]
	  	})
			

	  	//服务模式分布
	  	HOME_CHART.serviceType = echarts.init(document.getElementById('service-type'));
	  	HOME_CHART.serviceType.setOption({
	  		tooltip: {
		        trigger: 'item',
		        formatter: "{a} <br/>{b}: {c} ({d}%)"
		    },
		    color:['#02C868', '#2487FF','#FFC013','#1BC1F4','#8066FF','#ce1829'],
		    
		    series: [
		        {
		            name:'服务模式分布',
		            type:'pie',
		            radius: ['62%', '70%'],
		            center: ['50%', '50%'],
		            avoidLabelOverlap: false,
		            label: {
		                normal: {
		                    show: false,
		                    position: 'center'
		                },
		                emphasis: {
		                    show: false,
		                    textStyle: {
		                        fontSize: '30',
		                        fontWeight: 'bold'
		                    }
		                }
		            },
		            labelLine: {
		                normal: {
		                    show: false
		                }
		            },
		            data:_self.serviceTypeData
		        }
		    ]
	  	})
	  	
	  	// 硬件设备供应分类
			HOME_CHART.hardwareType = echarts.init(document.getElementById('hardware-type'));
			HOME_CHART.hardwareType.setOption({
				color: ['#3398DB'],
				tooltip: {
					trigger: 'axis',
					axisPointer: {
						type: 'line',
					},
				},
				grid: {
					left: '2%',
					right: '2%',
					bottom: '7%',
					containLabel: true
				},
				xAxis: [{
					type: 'category',
					data: _self.hardwareSupplyData.xData,
					axisTick: {
						show:false,
						alignWithLabel: true
					},
					axisLine: {
						lineStyle: {
							color: "#e6e9ee"
						}
					},
					axisLabel: {
						color: "#A5ADB8"
					}
				}],
				yAxis: [{
					type: 'value',
					splitLine: {
						show: false
					},
					name: '',
					axisLine: {
						show:false,
						lineStyle: {
							color: "#e6e9ee"
						}
					},
					axisLabel: {
						color: "#A5ADB8"
					},
					splitLine: {
						show: true,
					    lineStyle: {
					        color: '#e6e9ee'
					    }
					}
				}],
				series: [{
					name: "硬件设备供应个数",
					type: 'bar',
					barWidth: '25',
					label: {
						normal: {
							show: true,
							position: 'top',
							textStyle: {
								color: '#A5ADB8'
							}
						}
					},
        itemStyle: {
		        normal: {
		            show: true,
		            label : {show: true},
		            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
		                offset: 0,
		                color: '#40e1f7'
		            }, {
		                offset: 1,
		                color: '#3b8af7'
		            }]),
		            barBorderRadius: 3,
		            borderWidth: 0,
		        }
		    },
					data: _self.hardwareSupplyData.yData
				}]
			});
	  	
	  },
	  
	  setData(){
	  	var _self = this;  	
	  	
	  	//头部数据获取
      this.$axios.$POST({
        api_name: "findTotalNum",
        params: {}
      }).then(res => {
        if (res.data.code == 'success') {
          var _data = res.data.data;
          _self.unitData = _data;
        } else {
          console.log('没有数值。。。。。')
        }
      });
      
      //服务模式分布数据
      this.$axios.$POST({
        api_name: "findEnterpriseUnitModelCount",
        params: {}
      }).then(res => {
        if (res.data.code == 'success') {
          var _data = res.data.data;
          _self.serviceCompanyTotal = _data;
          var totalData = parseInt(_data.freeNum + _data.safetyNum + _data.transferNum + _data.hightNum + _data.fullyNum  + _data.primaryNum);
					
					function getRates(val){
						return (val*100).toFixed(2)+"%";
					}
					
          _self.serviceTypeData = [
          	{value: _data.freeNum, name:'免费模式',rate:getRates(_data.freeNum/totalData)},
          	{value: _data.transferNum, name:'转接模式',rate:getRates(_data.transferNum/totalData)},
            {value: _data.safetyNum, name:'基础安全模式',rate:getRates(_data.safetyNum/totalData)},
            {value: _data.primaryNum, name:'初级安全模式',rate:getRates(_data.primaryNum/totalData)},
            {value: _data.hightNum, name:'高级安全模式',rate:getRates(_data.hightNum/totalData)},
            {value: _data.fullyNum, name:'全托管模式',rate:getRates(_data.fullyNum/totalData)}
          ]
        } else {
          console.log('没有数值。。。。。')
        }
      });
      
      //新增企业趋势
      this.$axios.$POST({
        api_name: "newUnitForSixMonth",
        params: {}
      }).then(res => {
        if (res.data.code == 'success') {
          var _data = res.data.data;
					_self.newAddCompanyData = _data;
        } else {
          console.log('没有数值。。。。。')
        }
      });
      
      //硬件设备供应分类
      this.$axios.$POST({
        api_name: "getEnterpriseDevice",
        params: {}
      }).then(res => {
        if (res.data.code == 'success') {
          var _data = res.data.data;
					_self.hardwareSupplyData = _data
        } else {
          console.log('没有数值。。。。。')
        }
      });

	  }
	},
  mounted(){
  	
		this.setData();
		this.setChart();
		// resize 重新计算框架
		window.addEventListener('resize',function() {
			HOME_CHART.hardwareType.resize();
			HOME_CHART.serviceType.resize();
			HOME_CHART.newCompany.resize();
		});
  },
  watch:{
  	serviceTypeData: {
			handler() {
				var _self = this;
				HOME_CHART.serviceType.setOption({
					series: [
					    {
					        data: _self.serviceTypeData
					    }
					]
				})
	　　　　},
	　　　　deep: true
		},
		newAddCompanyData: {
			handler() {
				var _self = this;
				HOME_CHART.newCompany.setOption({
					xAxis: [{
					    data: _self.newAddCompanyData.xData
					}],
					series: [
					    {
					        data: _self.newAddCompanyData.yData
					    }
					]
				})
	　　},
	　　deep: true
		},
		hardwareSupplyData: {
			handler() {
				var _self = this;
				HOME_CHART.hardwareType.setOption({
					xAxis: [{
					    data: _self.hardwareSupplyData.xData
					}],
					series: [
					    {
					        data: _self.hardwareSupplyData.yData
					    }
					]
				})
	　　},
	　　deep: true
		},
  }
}
</script>

<style lang="scss" scoped="scoped">
	.alarm-device-rate{
		.alarm-rate,.device-rate{
			background: #fff;
			padding: 20px 20px 20px;
			border: 1px solid #e6e9ee;
			text-align: center;
			h4{
				height: 35px;
				border-bottom: 1px solid #e6e9ee;
				text-align: left;
			}
			p{
				font-size: 16px;
				color: #525C66;
			}
		}
	}
	.company-service-type{
		margin-bottom: 12px;
		.new-add-company,.service-type-place{
			background: #fff;
			padding: 20px 0 0;
			border: 1px solid #e6e9ee;
			h4{
				padding: 0 20px 0;
				height: 35px;
				border-bottom: 1px solid #e6e9ee;
			}
		}
		.m-title{
			text-align: center;
			position: absolute;
			top: 40%;
			left: 20%;
			z-index: 10;
			span{
				color: #525C66;
				font-size: 16px;
			}
			p{
				color: #25282E;
				padding-top: 20px;
				font-size: 26px;
			}
		}
		.m-list{
			position: absolute;
			top: 45px;
			li{
				width: 220px;
				color: #525C66;
				font-size: 16px;
				line-height: 35px;
				list-style: none;
				height: 35px;
				.label{
					float: left;
				}
				.count{
					float: right;
					font-weight: bold;
					width: 50px;
					text-align: right;
				}
				.rates{
					float: right;
					font-weight: normal;
					width: 50px;
					text-align: left;
					b{
						font-weight: normal;
						margin: 0 4px;
					}
					
				}
			}
			.dot{
				width: 8px;
				height: 8px;
				border-radius: 50%;
			  float: left;
			  margin-right: 10px;
				margin-top: 15px;
			}
			.dot.freeNum{
				background:#02C868;
			}
			.dot.safetyNum{
				background:#2487FF;
			}
			.dot.transferNum{
				background:#FFC013;
			}
			.dot.hightNum{
				background:#1BC1F4;
			}
			.dot.fullyNum{
				background:#8066FF;
			}
			.dot.primaryNum{
				background:#ce1829;
			}
		}
		.new-add-company{
			.company-data{
				height: 100%;
			}
			.company-echarts{
				border-left: 1px solid #e6e9ee;
			}
			ul{
				li{
					list-style: none;
					text-align: center;
					padding-bottom: 60px;
					p{
						font-size: 26px;
						padding-bottom: 15px;
						color: #25282E;
						font-weight: bold;
					}
					span{
						font-size: 16px;
						color: #525C66;
					}
				}
				li:nth-of-type(1){
					padding-top: 56px;
				}
			}
		}
	}

  .user-data-statistics{
  	position: relative;
  	padding-top: 20px;
  	.add-rate{
  		position: absolute;
  		right: 0px;
  		top: 36px;
  		color:#525C66 ;
  		font-size: 14px;
  		background: #F3F7FD;
  		width: 138px;
  		height: 32px;
  		text-align: center;
  		line-height: 32px;
  		border-radius: 20px 0 0 20px;
  		span{
  			color: #525C66;
  			font-size: 16px;
  			font-weight: bold;
  		}
  	}
  	.el-row{
  		margin-bottom: 12px;
  	}
  }
  .user-data-statistics .title{
  	padding-left: 26px;
  	font-weight: bold;
  	padding-bottom: 20px;
  	width: 150px;
  	border-bottom: 1px solid #e9e9e9;
  	margin-bottom: 10px;
  }
  .user-data-statistics .grid-content{
  	border: 1px solid #e9e9e9;
  	border-radius: 4px;
  	padding:24px;
  	position: relative;
  	background-color: #fff;
  }
  .user-data-statistics .grid-content .users-title{
  	color: #525C66;
  	font-size: 16px;
  	padding-bottom: 16px;
  }
  .user-data-statistics .grid-content .users-title i{
  	float: right;
  }
  .user-data-statistics .grid-content .users-number{
  	color: #000;
  	font-size: 26px;
		min-height: 29px;
  	font-weight: bold;
  }
  .user-data-statistics .grid-content .users-rate{
  	color: #000;
  	font-size: 14px;
  }
  .user-data-statistics .grid-content .users-rate span{ 
  	margin-right: 10px;
  }
  
  @media only screen and (min-width: 1000px) and (max-width: 1400px) {
  	.company-service-type .m-title{
  		left: 18%;
  	}
  }
  @media only screen and (min-width: 1400px) and (max-width: 1919px) {
  	.company-service-type .m-title{
  		left: 18%;
  	}
  }
</style>
