(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1196:function(e,t,r){"use strict";r.r(t);r(101),r(102),r(66);var o,l,n,d=r(159),m=(r(2),r(3),r(4),r(5),r(525)),c={components:{Pagination:r(490).a},data:function(){return{loading:!1,copyPower_disable:!0,default_active:"",systemList:[],userObj:{},widgetInfo:{total:null,pageSize:6,pageNo:1},dialogFormAdmin:!1,dialogFormAuthorize:!1,dialogForm_title:"",ruleForm_authorize:{data2:[],orgTree_checked:[],orgTree_expanded:[],defaultProps:{children:"children",label:"resName"}},checked:!1,ruleForm_admin:{roleName:"",roleAlias:"",roleRemark:"",optionsUser:[],valueUser:[],optionsAdmin:[{value:"选项1",label:"管理员"},{value:"选项2",label:"超级管理员"},{value:"选项3",label:"全部组织机构"}],valueAdmin:[],roleOrder:""},formLabelWidth:"85px",rules:{roleName:[{required:!0,message:"请填写角色名称",trigger:"blur"},{min:2,max:30,message:"角色名称字符需在2-30之间",trigger:"blur"}],roleAlias:[{required:!0,message:"请填写角色别名",trigger:"blur"},{min:2,max:30,message:"角色别名字符需在2-30之间",trigger:"blur"}]},currentPage1:1,tableData:[]}},mounted:function(){this.userObj=this._Storage.getObj("userObj","userObj")},created:function(){var e=this;this.loading=!0,this.$axios.$GET({api_name:"getSystemListNoPage"}).then(function(t){console.log(t,"this.res"),t.data&&"success"==t.data.code&&(e.systemList=t.data.data,e.default_active=t.data.data[0].sysCode,o=t.data.data[0])}).then(function(){e.loadData(o.sysCode)})},methods:{loadData:function(e){var t=this;this.$axios.$POST({api_name:"findRoleListBySysCodeAndPager",params:{sysCode:e,pageSize:this.widgetInfo.pageSize,pageNo:this.widgetInfo.pageNo}}).then(function(e){console.log(e,"res"),e.data&&"success"==e.data.code&&(t.widgetInfo.total=null==e.data.data.total?0:e.data.data.total,t.widgetInfo.pageSize=e.data.data.pageSize,t.widgetInfo.pageNo=e.data.data.pageNo,t.tableData=e.data.data.rows),t.loading=!1})},submitForm:function(e){var t=this;if("ruleForm_admin"===e){if(-1!==this.ruleForm_admin.roleName.indexOf(" "))return this.$message.error("角色名称和别名中不能含有空格"),!1;if(this.ruleForm_admin.roleRemark.length>0&&(this.ruleForm_admin.roleRemark.length<2||this.ruleForm_admin.roleRemark>50))return this.$message.error("备注字符需在2-30之间"),!1;this.$refs[e].validate(function(r){if(!r)return console.log("error submit!!"),!1;if(t.ruleForm_admin.valueUser.length>0)var n="1";else n="0";"新建角色"===t.dialogForm_title?t.$axios.$POST({api_name:"addRole",params:{roleOrder:t.ruleForm_admin.roleOrder,roleName:t.ruleForm_admin.roleName,roleAlias:t.ruleForm_admin.roleAlias,roleRemark:t.ruleForm_admin.roleRemark,sysCode:o.sysCode,dataRes:m.a,createUserId:t.userObj.id,orgCodes:t.ruleForm_admin.valueUser.join(","),roleType:n}}).then(function(r){console.log(r,"数据");var code=r.data.code,l=r.data.message;r&&"success"===code?(t.dialogFormAdmin=!1,t.$message.success(l),t.loadData(o.sysCode),t.$refs[e].resetFields()):(t.$message.error(l),t.$refs[e].resetFields())}):t.$axios.$POST({api_name:"updateRole",params:{id:l,roleOrder:t.ruleForm_admin.roleOrder,roleName:t.ruleForm_admin.roleName,roleAlias:t.ruleForm_admin.roleAlias,roleRemark:t.ruleForm_admin.roleRemark,sysCode:o.sysCode,dataRes:m.a,updateUserId:t.userObj.id,orgCodes:t.ruleForm_admin.valueUser.join(","),roleType:n}}).then(function(r){var code=r.data.code,l=r.data.message;r&&"success"===code?(t.dialogFormAdmin=!1,t.$message.success(l),t.loadData(o.sysCode),t.$refs[e].resetFields()):(t.$message.error(l),t.$refs[e].resetFields())})})}else if("ruleForm_authorize"===e){var r=[],c=!0,h=!1,f=void 0;try{for(var _,v=this.$refs.auth_tree.getCheckedNodes(!1,!0)[Symbol.iterator]();!(c=(_=v.next()).done);c=!0){var i=_.value;r.push(i.id)}}catch(e){h=!0,f=e}finally{try{c||null==v.return||v.return()}finally{if(h)throw f}}this.$axios.$POST({api_name:"giveRolesForResource",params:Object(d.a)({sysCode:o.sysCode,roleId:n.id,resourceIds:r.join(","),createUserId:n.createUserId,dataRes:m.a,createDate:""},"createUserId",this.userObj.id)}).then(function(r){var code=r.data.code,o=r.data.message;r&&"success"===code?(t.$message.success(o),t.dialogFormAuthorize=!1,t.$refs[e].resetFields()):(t.$message.error(o),t.$refs[e].resetFields())})}},sonHandleCurrentChange:function(e){this.widgetInfo.pageSize=e.pageSize?parseInt(e.pageSize):this.widgetInfo.pageSize,this.widgetInfo.pageNo=e.pageNo?parseInt(e.pageNo):this.widgetInfo.pageNo,o&&this.loadData(o.sysCode)},dialogForm:function(e,t){var r=this;if(this.dialogFormAdmin=!0,this.loading=!0,this.ruleForm_admin.roleOrder="",this.ruleForm_admin.roleName="",this.ruleForm_admin.roleAlias="",this.ruleForm_admin.roleRemark="",this.ruleForm_admin.optionsUser=[],this.ruleForm_admin.valueUser=[],"add_form"===e)this.dialogForm_title="新建角色",this.get_FormOrg();else{l=t,this.dialogForm_title="编辑角色";var o=[];this.$axios.$POST({api_name:"findRoleById",params:{roleId:t}}).then(function(e){if(console.log(e,"88888888"),e&&"success"===e.data.code){var data=e.data.data;if(r.ruleForm_admin.roleName=data.roleName,r.ruleForm_admin.roleAlias=data.roleAlias,r.ruleForm_admin.roleRemark=data.roleRemark,r.ruleForm_admin.roleOrder=data.roleOrder,data.orgList.length>0)for(var i in data.orgList)o.push(data.orgList[i].orgCode)}else r.$message.error(message)}).then(function(){r.get_FormOrg(o)})}},get_FormOrg:function(e){var t=this;this.$axios.$POST({api_name:"findOrgBySysCode",params:{sysCode:o.sysCode}}).then(function(r){var code=r.data.code,o=r.data.message;r&&"success"===code?(t.ruleForm_admin.optionsUser=r.data,e&&(t.ruleForm_admin.valueUser=e)):t.$message.error(o)}),this.loading=!1},dialogForm_delRows:function(e){var t=this;this.$confirm("确认删除角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.loading=!0,t.$axios.$POST({api_name:"deleteRole",params:{roleId:e.id}}).then(function(e){var code=e.data.code,r=e.data.message;e&&"success"===code?(t.$message.success(r),t.loadData(o.sysCode),t.loading=!1):(t.$message.error(r),t.loading=!1)})}).catch(function(){t.$message("取消删除！"),t.loading=!1})},authorize:function(e){var t=this;n=e,console.log(e,"row"),this.dialogFormAuthorize=!0,this.loading=!0,this.ruleForm_authorize.orgTree_checked=[],this.ruleForm_authorize.orgTree_expanded=[],this.$axios.$POST({api_name:"findTreeBySysCode",params:{sysCode:o.sysCode}}).then(function(e){console.log(e,"333");var code=e.data.code,r=e.data.message;if(e&&"success"===code){!function e(t){for(var i in t)t[i].resName+="（"+t[i].resAlias+"）",t[i].children.length>0&&e(t[i].children)}(e.data.data),t.ruleForm_authorize.data2=e.data.data}else t.$message.error(r)}).then(function(){t.$axios.$POST({api_name:"findResourceByRoleId",params:{roleId:e.id}}).then(function(e){var code=e.data.code,r=e.data.message,o=(e.data.data,[]);if(e&&"success"===code){!function e(t){for(var i in t)t[i].children.length>0?e(t[i].children):o.push(t[i].id)}(e.data.data),t.ruleForm_authorize.orgTree_checked=o}else t.$message.error(r);t.loading=!1})})},handleSizeChange:function(e){console.log("每页 ".concat(e," 条"))},handleCurrentChange:function(e){console.log("当前页: ".concat(e))},organize_change:function(e){o=e,this.loading=!0,this.loadData(e.sysCode)},copy_power:function(){this.copyPower_disable=!this.copyPower_disable,!1===this.checked&&this.ruleForm_admin.valueAdmin.length>0&&(this.ruleForm_admin.valueAdmin=[])}}},h=(r(779),r(18)),component=Object(h.a)(c,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"admin_manage"},[r("div",{staticClass:"Crumbs"},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",[e._v("权限平台")]),e._v(" "),r("el-breadcrumb-item",[e._v("应用角色管理")])],1)],1),e._v(" "),r("div",{staticClass:"admin_manage_main"},[r("div",{staticClass:"admin_manage_aside"},[r("el-menu",{staticClass:"el-menu-vertical-demo el-menu-origanizeUl",attrs:{"default-active":e.default_active}},e._l(e.systemList,function(t){return r("el-menu-item",{key:t.sysCode,staticClass:"organizeSelect",attrs:{index:t.sysCode},on:{click:function(r){return e.organize_change(t)}}},[r("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.sysName))])])}),1)],1),e._v(" "),r("div",{staticClass:"main_table",staticStyle:{width:"100%"}},[r("el-button",{staticClass:"add_btn",attrs:{type:"primary"},on:{click:function(t){return e.dialogForm("add_form")}}},[e._v("新增")]),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"sysAdmin_table",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.tableData,border:""}},[r("el-table-column",{attrs:{prop:"roleOrder",label:"序号","show-overflow-tooltip":!0}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleName",label:"角色名称","show-overflow-tooltip":!0}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleAlias",label:"角色别名","show-overflow-tooltip":!0}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleRemark","show-overflow-tooltip":!0,label:"备注"}}),e._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.dialogForm("update_form",t.row.id)}}},[e._v("编辑")]),e._v(" "),r("span",{staticStyle:{color:"#409EFF"}},[e._v("|")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.dialogForm_delRows(t.row)}}},[e._v("删除")]),e._v(" "),r("span",{staticStyle:{color:"#409EFF"}},[e._v("|")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.authorize(t.row)}}},[e._v("授权")])]}}])})],1),e._v(" "),r("Pagination",{attrs:{widgetInfo:e.widgetInfo},on:{sonHandleCurrentChange:e.sonHandleCurrentChange}}),e._v(" "),r("el-dialog",{attrs:{title:e.dialogForm_title,visible:e.dialogFormAdmin,width:"24%"},on:{"update:visible":function(t){e.dialogFormAdmin=t}}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm_admin",attrs:{model:e.ruleForm_admin,rules:e.rules}},[r("el-form-item",{attrs:{label:"角色名称",prop:"roleName","label-width":e.formLabelWidth}},[r("el-input",{attrs:{autocomplete:"off",placeholder:"请输入角色名称"},model:{value:e.ruleForm_admin.roleName,callback:function(t){e.$set(e.ruleForm_admin,"roleName","string"==typeof t?t.trim():t)},expression:"ruleForm_admin.roleName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色别名",prop:"roleAlias","label-width":e.formLabelWidth}},[r("el-input",{attrs:{autocomplete:"off",placeholder:"请输入角色别名"},model:{value:e.ruleForm_admin.roleAlias,callback:function(t){e.$set(e.ruleForm_admin,"roleAlias","string"==typeof t?t.trim():t)},expression:"ruleForm_admin.roleAlias"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"roleRemark","label-width":e.formLabelWidth}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.ruleForm_admin.roleRemark,callback:function(t){e.$set(e.ruleForm_admin,"roleRemark",t)},expression:"ruleForm_admin.roleRemark"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"适用范围",prop:"optionsUser","label-width":e.formLabelWidth}},[r("el-select",{staticClass:"formAdmin_select",attrs:{filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.ruleForm_admin.valueUser,callback:function(t){e.$set(e.ruleForm_admin,"valueUser",t)},expression:"ruleForm_admin.valueUser"}},e._l(e.ruleForm_admin.optionsUser,function(e){return r("el-option",{key:e.orgCode,attrs:{label:e.orgName,value:e.orgCode}})}),1)],1),e._v(" "),r("div",{staticClass:"msgbox-item"},[r("div",{staticClass:"item-name",staticStyle:{width:"85px"}},[r("b",{staticStyle:{color:"#f00"}},[e._v("* ")]),e._v("序号: ")]),e._v(" "),r("div",{staticStyle:{display:"flex"}},[r("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.ruleForm_admin.roleOrder,callback:function(t){e.$set(e.ruleForm_admin,"roleOrder",t)},expression:"ruleForm_admin.roleOrder"}})],1)])],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormAdmin=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm_admin")}}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"角色授权",visible:e.dialogFormAuthorize,width:"24%"},on:{"update:visible":function(t){e.dialogFormAuthorize=t}}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm_authorize",staticStyle:{"max-height":"300px",overflow:"auto"},attrs:{model:e.ruleForm_authorize,rules:e.rules}},[r("el-tree",{ref:"auth_tree",attrs:{data:e.ruleForm_authorize.data2,"show-checkbox":"","node-key":"id","default-expanded-keys":e.ruleForm_authorize.orgTree_expanded,"default-checked-keys":e.ruleForm_authorize.orgTree_checked,props:e.ruleForm_authorize.defaultProps}})],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormAuthorize=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm_authorize")}}},[e._v("确 定")])],1)],1)],1)])])},[],!1,null,"0254386f",null);t.default=component.exports},490:function(e,t,r){"use strict";r(2),r(3),r(4),r(5);var o={props:{widgetInfo:Object},data:function(){return{}},methods:{handleSizeChange:function(e){this.pageSize=e,this.$emit("sonHandleCurrentChange",{pageSize:this.pageSize})},handleCurrentChange:function(e){this.$emit("sonHandleCurrentChange",{pageNo:e})}},mounted:function(){this.$emit("sonHandleCurrentChange",{pageSize:10,pageNo:1})}},l=r(18),component=Object(l.a)(o,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-pagination",{attrs:{"current-page":this.widgetInfo.pageNo,"page-sizes":[10,15,20,25],"page-size":this.widgetInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:this.widgetInfo.total},on:{"size-change":this.handleSizeChange,"current-change":this.handleCurrentChange}})],1)},[],!1,null,null,null);t.a=component.exports},525:function(e,t,r){"use strict";r.d(t,"b",function(){return o}),r.d(t,"a",function(){return l});r(2),r(3),r(4),r(5);var o={sysCode:"manager"},l="manager"},599:function(e,t,r){var content=r(780);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(10).default)("086ddd75",content,!0,{sourceMap:!1})},779:function(e,t,r){"use strict";var o=r(599);r.n(o).a},780:function(e,t,r){(e.exports=r(9)(!1)).push([e.i,".admin_manage[data-v-0254386f]{height:calc(100vh - 65px);overflow:hidden}.admin_manage .el-container.is-vertical[data-v-0254386f]{background:#edf0f7}.admin_manage .admin_manage_header[data-v-0254386f]{height:40px!important;box-shadow:none;background:#edf0f7;margin:0}.admin_manage .bread_crumb[data-v-0254386f]{line-height:40px;box-shadow:none}.admin_manage .admin_manage_main[data-v-0254386f]{background:#eff3f5;border:1px solid #e1e4e6}.admin_manage .main_table[data-v-0254386f]{background:#fff;height:calc(100vh - 105px)}.admin_manage .adminManage_title[data-v-0254386f]{line-height:60px;height:60px}.admin_manage .organizeSelect[data-v-0254386f]{height:56px;width:9%;text-align:center;line-height:56px;font-size:16px;float:left}.admin_manage .organizeSelect.is-active[data-v-0254386f]{background:#f7f7f7!important;color:#000}.admin_manage .organizeSelect[data-v-0254386f]:hover{background:#f7f7f7!important}.admin_manage .organizeSelect.is-active span[data-v-0254386f],.admin_manage .organizeSelect:hover span[data-v-0254386f]{background:none!important}.admin_manage .adminManage_title[data-v-0254386f]{font-size:20px;background:#fff;border-bottom:1px solid #e1e4e6;padding-left:20px;text-align:left}.admin_manage .main_table .add_btn[data-v-0254386f]{float:right;line-height:10px;margin-top:10px;margin-bottom:16px;width:86px;height:32px;margin-right:20px}.admin_manage .admin_manage_aside[data-v-0254386f]{text-align:left;box-shadow:2px 0 5px rgba(0,0,0,.1);z-index:9}.admin_manage .el-menu-origanizeUl[data-v-0254386f]{overflow:auto}.el-dialog .el-dialog__header[data-v-0254386f]{padding-top:10px;background:#254f85}.formAdmin_select[data-v-0254386f]{width:100%}.msgbox-item[data-v-0254386f]{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;position:relative;margin:10px 0}",""])}}]);