(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1174:function(e,t,r){"use strict";r.r(t);r(33),r(101),r(102),r(66);var o,l,n=r(159),d=(r(2),r(3),r(4),r(5),r(51),r(490)),m=r(525),c={components:{Pagination:d.a},data:function(){var e;return e={isLoading:!1,currentBtns:[],btns:[{name:"新增角色",isShow:!1},{name:"编辑",isShow:!1},{name:"删除",isShow:!1},{name:"授权",isShow:!0}],formData:{},tableData:[],userObj:{},loading:!0,widgetInfo:{pageSize:10,pageNo:1,total:0}},Object(n.a)(e,"loading",!1),Object(n.a)(e,"copyPower_disable",!0),Object(n.a)(e,"default_active",""),Object(n.a)(e,"systemList",[]),Object(n.a)(e,"widgetInfo",{total:null,pageSize:6,pageNo:1}),Object(n.a)(e,"dialogFormAdmin",!1),Object(n.a)(e,"dialogFormAuthorize",!1),Object(n.a)(e,"dialogForm_title",""),Object(n.a)(e,"ruleForm_authorize",{data2:[],orgTree_checked:[],orgTree_expanded:[],defaultProps:{children:"children",label:"resName"}}),Object(n.a)(e,"checked",!1),Object(n.a)(e,"ruleForm_admin",{roleName:"",roleAlias:"",roleRemark:"",optionsAdmin:[{value:"选项1",label:"管理员"},{value:"选项2",label:"超级管理员"},{value:"选项3",label:"全部组织机构"}],valueAdmin:[],roleOrder:""}),Object(n.a)(e,"formLabelWidth","85px"),Object(n.a)(e,"rules",{roleName:[{required:!0,message:"请填写角色名称",trigger:"blur"},{min:2,max:30,message:"角色名称字符需在2-30之间",trigger:"blur"}],roleAlias:[{required:!0,message:"请填写角色别名",trigger:"blur"},{min:2,max:30,message:"角色别名字符需在2-30之间",trigger:"blur"}]}),Object(n.a)(e,"currentPage1",1),Object(n.a)(e,"dialogVisible",!1),Object(n.a)(e,"ruleForm",{roleName:"",remarks:""}),e},mounted:function(){this.userObj=this._Storage.getObj("userObj","userObj"),this.currentBtns=this._Storage.getObj("currentBtnArr","currentBtnArr"),this.isBtnShow()},computed:{},created:function(){this.loading=!0,this.loadData(m.b.sysCode)},methods:{loadData:function(e){var t=this;this.$axios.$POST({api_name:"findRoleListBySysCodeAndPager",params:{sysCode:e,pageSize:this.widgetInfo.pageSize,pageNo:this.widgetInfo.pageNo}}).then(function(e){e&&"success"==e.data.code&&(t.widgetInfo.total=null==e.data.data.total?0:e.data.data.total,t.widgetInfo.pageSize=e.data.data.pageSize,t.widgetInfo.pageNo=e.data.data.pageNo,t.tableData=e.data.data.rows,console.log(t.tableData,"this.tableData")),t.loading=!1})},submitForm:function(e){var t=this;if("ruleForm_admin"===e){if(-1!==this.ruleForm_admin.roleName.indexOf(" "))return this.$message.error("角色名称和别名中不能含有空格"),!1;if(this.ruleForm_admin.roleRemark.length>0&&(this.ruleForm_admin.roleRemark.length<2||this.ruleForm_admin.roleRemark.length>30))return this.$message.error("备注字符需在2-30之间"),!1;this.$refs[e].validate(function(r){if(!r)return console.log("error submit!!"),!1;if("新建角色"===t.dialogForm_title){for(var i=0;i<t.tableData.length;i++)if(t.tableData[i].roleName===t.ruleForm_admin.roleName)return t.$message.error("角色名称已经存在"),!1;t.loading=!0,t.$axios.$POST({api_name:"addRole",params:{roleOrder:t.ruleForm_admin.roleOrder,roleName:t.ruleForm_admin.roleName,roleAlias:t.ruleForm_admin.roleAlias,roleRemark:t.ruleForm_admin.roleRemark,sysCode:m.b.sysCode,dataRes:m.a,createUserId:t.userObj.id}}).then(function(r){console.log(r,"新建角色数据");var code=r.data.code,o=r.data.message;r&&"success"===code?(t.dialogFormAdmin=!1,t.$message.success(o),t.loading=!1,t.loadData(m.b.sysCode),t.$refs[e].resetFields()):(t.loading=!1,t.$message.error(o),t.$refs[e].resetFields())})}else t.$axios.$POST({api_name:"updateRole",params:{id:o,roleOrder:t.ruleForm_admin.roleOrder,roleName:t.ruleForm_admin.roleName,roleAlias:t.ruleForm_admin.roleAlias,roleRemark:t.ruleForm_admin.roleRemark,sysCode:m.b.sysCode,dataRes:m.a,updateUserId:t.userObj.id}}).then(function(r){var code=r.data.code,o=r.data.message;r&&"success"===code?(t.dialogFormAdmin=!1,t.$message.success(o),t.loadData(m.b.sysCode),t.$refs[e].resetFields()):(t.$message.error(o),t.$refs[e].resetFields())})})}else if("ruleForm_authorize"===e){var r=[],n=!0,d=!1,c=void 0;try{for(var h,f=this.$refs.auth_tree.getCheckedNodes(!1,!0)[Symbol.iterator]();!(n=(h=f.next()).done);n=!0){var i=h.value;r.push(i.id)}}catch(e){d=!0,c=e}finally{try{n||null==f.return||f.return()}finally{if(d)throw c}}this.$axios.$POST({api_name:"giveRolesForResource",params:{sysCode:m.b.sysCode,roleId:l.id,resourceIds:r.join(","),createUserId:l.createUserId,dataRes:m.a,createDate:""}}).then(function(r){var code=r.data.code,o=r.data.message;r&&"success"===code?(t.$message.success(o),t.dialogFormAuthorize=!1,t.$refs[e].resetFields()):(t.$message.error(o),t.$refs[e].resetFields())})}},sonHandleCurrentChange:function(e){this.widgetInfo.pageSize=e.pageSize?parseInt(e.pageSize):this.widgetInfo.pageSize,this.widgetInfo.pageNo=e.pageNo?parseInt(e.pageNo):this.widgetInfo.pageNo,this.loadData(m.b.sysCode)},dialogForm:function(e,t){var r=this;this.dialogFormAdmin=!0,this.loading=!0,this.ruleForm_admin.roleOrder="",this.ruleForm_admin.roleName="",this.ruleForm_admin.roleAlias="",this.ruleForm_admin.roleRemark="","add_form"===e?(this.dialogForm_title="新建角色",this.loading=!1):(o=t,this.dialogForm_title="编辑角色",this.$axios.$POST({api_name:"findRoleById",params:{roleId:t}}).then(function(e){var code=e.data.code,t=e.data.message;if(e&&"success"===code){var data=e.data.data;r.ruleForm_admin.roleName=data.roleName,r.ruleForm_admin.roleAlias=data.roleAlias,r.ruleForm_admin.roleRemark=data.roleRemark,r.ruleForm_admin.roleOrder=data.roleOrder}else r.$message.error(t)}),this.loading=!1)},dialogForm_delRows:function(e){var t=this;this.$confirm("确认删除角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.loading=!0,t.$axios.$POST({api_name:"deleteRole",params:{roleId:e.id}}).then(function(e){var code=e.data.code,r=e.data.message;e&&"success"===code?(t.$message.success(r),t.loadData(m.b.sysCode),t.loading=!1):(t.$message.error(r),t.loading=!1)})}).catch(function(){t.$message("取消删除！"),t.loading=!1})},authorize:function(e){var t=this;l=e,console.log(e,"row"),this.dialogFormAuthorize=!0,this.loading=!0,this.ruleForm_authorize.orgTree_checked=[],this.ruleForm_authorize.orgTree_expanded=[],this.$axios.$POST({api_name:"findTreeBySysCode",params:{sysCode:m.b.sysCode}}).then(function(e){console.log(e,"333");var code=e.data.code,r=e.data.message;if(e&&"success"===code){!function e(t){for(var i in t)t[i].children.length>0&&e(t[i].children)}(e.data.data),t.ruleForm_authorize.data2=e.data.data}else t.$message.error(r)}).then(function(){t.$axios.$POST({api_name:"findResourceByRoleId",params:{roleId:e.id}}).then(function(e){var code=e.data.code,r=e.data.message,o=(e.data.data,[]);if(e&&"success"===code){!function e(t){for(var i in t)t[i].children.length>0?e(t[i].children):o.push(t[i].id)}(e.data.data),t.ruleForm_authorize.orgTree_checked=o}else t.$message.error(r);t.loading=!1})})},handleSizeChange:function(e){console.log("每页 ".concat(e," 条"))},handleCurrentChange:function(e){console.log("当前页: ".concat(e))},organize_change:function(e){system_item=e,this.loading=!0,this.loadData(e.sysCode)},copy_power:function(){this.copyPower_disable=!this.copyPower_disable,!1===this.checked&&this.ruleForm_admin.valueAdmin.length>0&&(this.ruleForm_admin.valueAdmin=[])},isBtnShow:function(){var e=this.currentBtns;this.btns.forEach(function(element){e.forEach(function(e){console.log(e),e.name===element.name&&(element.isShow=e.isShow)})})}}},h=(r(829),r(831),r(18)),component=Object(h.a)(c,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"Crumbs"},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",[e._v("系统配置")]),e._v(" "),r("el-breadcrumb-item",[e._v("角色管理")])],1)],1),e._v(" "),r("div",{staticClass:"main-wrap"},[r("el-row",{staticClass:"location"},[r("el-col",{attrs:{span:12}},[r("h3",[e._v("角色管理")])]),e._v(" "),r("el-col",{staticClass:"add-btn-style",attrs:{span:12}},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.btns[0].isShow,expression:"btns[0].isShow"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.dialogForm("add_form")}}},[e._v("新增角色")])],1)],1),e._v(" "),r("el-main",{staticClass:"main_table",staticStyle:{width:"100%"}},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"sysAdmin_table",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.tableData,border:""}},[r("el-table-column",{attrs:{prop:"roleOrder",label:"序号","show-overflow-tooltip":!0}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleName",label:"角色名称","show-overflow-tooltip":!0}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleAlias",label:"角色别名","show-overflow-tooltip":!0}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleRemark","show-overflow-tooltip":!0,label:"备注"}}),e._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.btns[1].isShow,expression:"btns[1].isShow"}],attrs:{type:"text",size:"small"},on:{click:function(r){return e.dialogForm("update_form",t.row.id)}}},[e._v("\n                编辑\n                "),r("span",{staticClass:"margin-all"},[e._v("|")])]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.btns[2].isShow,expression:"btns[2].isShow"}],attrs:{type:"text",size:"small"},on:{click:function(r){return e.dialogForm_delRows(t.row)}}},[e._v("\n                删除\n                "),r("span",{staticClass:"margin-all"},[e._v("|")])]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.btns[3].isShow,expression:"btns[3].isShow"}],attrs:{type:"text",size:"small"},on:{click:function(r){return e.authorize(t.row)}}},[e._v("授权")])]}}])})],1),e._v(" "),r("Pagination",{attrs:{widgetInfo:e.widgetInfo},on:{sonHandleCurrentChange:e.sonHandleCurrentChange}}),e._v(" "),r("el-dialog",{attrs:{title:e.dialogForm_title,visible:e.dialogFormAdmin,width:"24%"},on:{"update:visible":function(t){e.dialogFormAdmin=t}}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm_admin",attrs:{model:e.ruleForm_admin,rules:e.rules}},[r("el-form-item",{attrs:{label:"角色名称",prop:"roleName","label-width":e.formLabelWidth}},[r("el-input",{attrs:{autocomplete:"off",placeholder:"请输入角色名称"},model:{value:e.ruleForm_admin.roleName,callback:function(t){e.$set(e.ruleForm_admin,"roleName","string"==typeof t?t.trim():t)},expression:"ruleForm_admin.roleName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色别名",prop:"roleAlias","label-width":e.formLabelWidth}},[r("el-input",{attrs:{autocomplete:"off",placeholder:"请输入角色别名"},model:{value:e.ruleForm_admin.roleAlias,callback:function(t){e.$set(e.ruleForm_admin,"roleAlias","string"==typeof t?t.trim():t)},expression:"ruleForm_admin.roleAlias"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"roleRemark","label-width":e.formLabelWidth}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.ruleForm_admin.roleRemark,callback:function(t){e.$set(e.ruleForm_admin,"roleRemark",t)},expression:"ruleForm_admin.roleRemark"}})],1),e._v(" "),r("div",{staticClass:"msgbox-item"},[r("div",{staticClass:"item-name",staticStyle:{width:"85px"}},[r("b",{staticStyle:{color:"#f00"}},[e._v("*")]),e._v("序号:\n              ")]),e._v(" "),r("div",{staticStyle:{display:"flex"}},[r("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.ruleForm_admin.roleOrder,callback:function(t){e.$set(e.ruleForm_admin,"roleOrder",t)},expression:"ruleForm_admin.roleOrder"}})],1)])],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormAdmin=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm_admin")}}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"角色授权",visible:e.dialogFormAuthorize,width:"24%"},on:{"update:visible":function(t){e.dialogFormAuthorize=t}}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm_authorize",staticStyle:{"max-height":"300px",overflow:"auto"},attrs:{model:e.ruleForm_authorize,rules:e.rules}},[r("el-tree",{ref:"auth_tree",attrs:{data:e.ruleForm_authorize.data2,"show-checkbox":"","node-key":"id","default-expanded-keys":e.ruleForm_authorize.orgTree_expanded,"default-checked-keys":e.ruleForm_authorize.orgTree_checked,props:e.ruleForm_authorize.defaultProps}})],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormAuthorize=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm_authorize")}}},[e._v("确 定")])],1)],1)],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"编辑权限",visible:e.dialogVisible,width:"530px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("div",{staticClass:"dialog-body-diy-wrapper"}),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(e){}}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(e){}}},[e._v("取 消")])],1)])],1)},[],!1,null,"44739498",null);t.default=component.exports},490:function(e,t,r){"use strict";r(2),r(3),r(4),r(5);var o={props:{widgetInfo:Object},data:function(){return{}},methods:{handleSizeChange:function(e){this.pageSize=e,this.$emit("sonHandleCurrentChange",{pageSize:this.pageSize})},handleCurrentChange:function(e){this.$emit("sonHandleCurrentChange",{pageNo:e})}},mounted:function(){this.$emit("sonHandleCurrentChange",{pageSize:10,pageNo:1})}},l=r(18),component=Object(l.a)(o,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-pagination",{attrs:{"current-page":this.widgetInfo.pageNo,"page-sizes":[10,15,20,25],"page-size":this.widgetInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:this.widgetInfo.total},on:{"size-change":this.handleSizeChange,"current-change":this.handleCurrentChange}})],1)},[],!1,null,null,null);t.a=component.exports},525:function(e,t,r){"use strict";r.d(t,"b",function(){return o}),r.d(t,"a",function(){return l});r(2),r(3),r(4),r(5);var o={sysCode:"manager"},l="manager"},621:function(e,t,r){var content=r(830);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(10).default)("38179c30",content,!0,{sourceMap:!1})},622:function(e,t,r){var content=r(832);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(10).default)("14bddd1d",content,!0,{sourceMap:!1})},829:function(e,t,r){"use strict";var o=r(621);r.n(o).a},830:function(e,t,r){(e.exports=r(9)(!1)).push([e.i,".record-table[data-v-44739498]{height:400px}.add-btn-style[data-v-44739498]{text-align:right;padding-right:25px;box-sizing:border-box}.main_table[data-v-44739498] .el-table .el-table__body-wrapper{height:calc(100vh - 387px);overflow-y:auto}.main_table[data-v-44739498] .el-table .el-table__body-wrapper .margin-all{margin-left:7px}.main_table[data-v-44739498] .el-table .el-table__body-wrapper .el-button--small,.main_table[data-v-44739498] .el-table .el-table__body-wrapper .el-button--small.is-round{padding:9px 0}.hardware-form .el-form-item[data-v-44739498]{width:23%}.hardware-form[data-v-44739498]{padding-left:25px}.msgbox-item[data-v-44739498]{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;position:relative;margin:10px 0}@media screen and (max-width:1680px){.main_table[data-v-44739498] .el-table .el-table__body-wrapper{height:calc(100vh - 357px);overflow-y:auto}}",""])},831:function(e,t,r){"use strict";var o=r(622);r.n(o).a},832:function(e,t,r){(e.exports=r(9)(!1)).push([e.i,".el-scrollbar__wrap{overflow-x:hidden}",""])}}]);